{% extends 'template/jhTemplateV4.html'%}
{% block vueTemplate %}
<script type="text/html" id="app-template">
  <div>
    <v-app mobile-breakpoint="sm">
      <v-main>
        <!-- 头部内容 >>>>>>>>>>>>> -->
        <div class="jh-page-second-bar px-8">
          <v-row class="align-center">
            <v-col cols="12" xs="12" sm="12" md="4" xl="3">
              <div class="py-4 text-body-1 font-weight-bold">目录管理
                <!-- 帮助页按钮 -->
                <span role="button" class="success--text font-weight-regular jh-font-size-13 ml-2" @click="isHelpPageDrawerShown = true">
                  <v-icon size="13" class="success--text">mdi-help-circle-outline</v-icon>帮助
                </span>
              </div>
            </v-col>
          </v-row>
        </div>
        <!-- <<<<<<<<<<<<< 头部内容 -->

        <!-- 页面内容 >>>>>>>>>>>>> -->
        <div class="jh-page-body-container px-8">
          <v-container class="pa-0">
            <v-card class="jh-wrapper-card">
              <v-row dense no-gutters>
                <!-- 应用 -->
                <v-col cols="12" xs="12" sm="4" md="3" xl="2" class="pr-sm-2">
                  <v-card flat class="pa-4 jh-directory-card">
                    <div class="jh-directory-card-body">
                      <v-skeleton-loader
                        type="list-item-three-line, list-item-three-line, list-item-three-line"
                        v-if="isDirectoryLoading"
                      ></v-skeleton-loader>
                      <template v-else>
                        <template v-if="directoryList">
                          <div v-for="(value, key) in directoryList" :key="key" class="py-2">
                            <p class="pl-2 mb-2 grey--text font-weight-medium mt-2">{{value[0].appGroupName}}</p>
                            <v-list dense class="pa-0" color="grey lighten-5">
                              <v-list-item-group color="success">
                                <v-list-item 
                                  v-for="(item, i) in value" 
                                  :key="item.appId + '-' + item.loginId + '-' + item.appGroupNumber + '-' + item.appGroupItemSort + '-' + i"
                                  @click="doUiAction('jump', item.url)">
                                  <div class="d-flex align-center">
                                    <span class="ml-2">{{item.displayName}}</span>
                                  </div>
                                </v-list-item>
                              </v-list-item-group>
                            </v-list>
                          </div>
                        </template>
                        <div v-else class="text-center mt-10">暂无数据~</div>
                      </template>
                    </div>
                  </v-card>
                </v-col>

                <!-- 工作台 -->
                <v-col cols="12" xs="12" sm="8" md="9" xl="10">
                  <v-card flat class="pa-4 jh-dashboard-wrapper-card">
                    <div class="jh-directory-card-body">
                      <!-- 模板 -->
                      <template v-if="directoryList">
                        <div v-for="(value, key) in directoryList" :key="key">
                          <div class="font-weight-medium text-subtitle-1">{{value[0].appGroupName}}</div>
                          <v-row class="mt-1">
                            <v-col cols="3" xs="12"
                               v-for="(item, i) in value"  
                               :key="item.appId + '-' + item.loginId + '-' + item.appGroupNumber + '-' + item.appGroupItemSort + '-' + i"
                               @click="doUiAction('jump', item.url)">
                              <v-card class="rounded-lg mb-6 pa-4 jh-dashboard-card">
                                <div class="font-weight-medium text-subtitle-2">{{item.displayName}}</div>
                                <div class="text--secondary text-caption mt-2">{{item.description}}</div>
                              </v-card>
                            </v-col>
                          </v-row> 
                        </div>
                      </template>
                     
                      <!-- 空数据 -->
                      <!-- <div class="text-center mt-10">暂无数据~</div> -->
                    </template>
                  </v-card>
                </v-col>
              </v-row>
            </v-card>
          </v-container>
        </div>
        <!-- <<<<<<<<<<<<< 页面内容 -->

        <!-- 帮助页抽屉 >>>>>>>>>>>>> -->
        <v-navigation-drawer v-model="isHelpPageDrawerShown" fixed temporary right width="80%" class="elevation-24">
          <iframe style="border: 0" :src="`/${appInfo.appId}/pageDoc#1.directory.md`" width="100%" height="100%"></iframe>
          <v-btn elevation="0" color="success" fab absolute top left small tile class="drawer-close-float-btn" @click="isHelpPageDrawerShown = false">
            <v-icon>mdi-close</v-icon>
          </v-btn>
        </v-navigation-drawer>
        <!-- <<<<<<<<<<<<< 帮助页抽屉 -->
      </v-main>
      </v-app>
    <jh-toast />
    <jhMask />
    <jhConfirmDialog />
  </div>
</script>
<div id="app">
</div>
{% endblock %}
{% block vueScript %}
<script type="module">

  new Vue({
    el: '#app',
    template: '#app-template',
    vuetify: new Vuetify(),
    // mixins: [window.jianghuUiActionMixins],
    data: {
      isMobile: window.innerWidth < 500,
      selectedUrlItem: null,
      isHelpPageDrawerShown: false,
      
      dashboardList: ['模板', '人资', '后勤', '校务', '教务', '财务', '公共关系'],
      activeDashboard: 0,

      constantObj: {
        status: [
            {text: "在职", value: 1},
            {text: "入职", value: 2},
            {text: "待入职", value: 3},
            {text: "离职", value: 4},
            {text: "待离职", value: 5},
            {text: "转正", value: 6},
            {text: "调岗", value: 7},
        ],
        status1: [
            {text: "正在招聘职位", value: 1},
            {text: "评选中", value: 2},
            {text: "待入职", value: 3},
            {text: "已入职", value: 4},
        ],
        status2: [
            {text: "计薪人员", value: 1},
            {text: "实发工资", value: 2},
        ],
        status3: [
            {text: "待审核薪资", value: 1},
            {text: "待离职", value: 2},
            {text: "合同到期", value: 3},
        ],
        status4: [
            {text: "待转正", value: 4},
            {text: "待入职", value: 5},
            {text: "生日", value: 6},
        ],
      },
      picker: (new Date(Date.now() - (new Date()).getTimezoneOffset() * 60000)).toISOString().substr(0, 10),
      tableData: [
        {
          name: 'Frozen Yogurt',
          calories: 159,
        },
        {
          name: 'Ice cream sandwich',
          calories: 237,
        },
        {
          name: 'Eclair',
          calories: 262,
        }
      ],

      tabs: [
        { title: '已完成考核', action: 'post' },
        { title: '进行中考核', action: 'basic' },
      ],
      actionTab: 0,

      isDirectoryLoading: true,
      directorySearchInput: null,
      directoryList: null,
      directorySearchList: null
    },
    computed: {
      isMobile() {
        return window.innerWidth < 600;
      },
    },
    watch: {
      directorySearchInput() {
        this.doUiAction('directorySearch')
      },
    },
    async created() {
    },
    mounted() {
      this.doUiAction('getTableData');
    },
    methods: {
      async doUiAction(uiActionId,uiActionData){
        switch(uiActionId){
          case 'directorySearch':
            await this.directorySearch();
            break;
          case 'getTableData':
            await this.getTableData();
            break;
          case 'jump':
            await this.jump(uiActionData);
            break;
          default:
            console.error("[doUiAction] uiActionId not find", { uiActionId });
            break;
        }
      },

      // ---------- 目录搜索 uiAction >>>>>>>>>>>> --------
       async directorySearch() {
        const searchVal = this.directorySearchInput ? this.directorySearchInput.toLowerCase() : null;
        const directoryList = _.cloneDeep(this.directoryList);
        if (searchVal) {
          this.directorySearchList = _.filter(directoryList, item => {
            return _.some(item, subItem => {
              return _.isObject(subItem) && _.some(subItem, value => {
                return _.isString(value) && value.includes(searchVal);
              });
            });
          });
        }else{
          this.directorySearchList = directoryList;
        }
      },
      // ---------- <<<<<<<<<<< 目录搜索 uiAction  --------

      /**
       * 获取表格数据
       */
      async getTableData() {
        this.isDirectoryLoading = true;
        const result = await window.jianghuAxios({
          data: {
            appData: {
              pageId: 'directory',
              actionId: 'selectItemList',
              orderBy: [{column: 'operationAt', order: 'desc'}]
            }
          }
        });
        this.directoryList = _
        .chain(result.data.appData.resultData.rows)
        .sortBy('appGroupItemSort')
        .groupBy('appGroupNumber')
        .value();
        this.isDirectoryLoading = false;
      },
      jump(url) {
        window.open(url);
      }
    }
  })
</script>

<style scoped>
  .jh-wrapper-card{
    min-height: calc(100vh - 151px);
  }
  .v-divider{
    border-color: #F4F5F6 !important;
  }
  .jh-directory-card{
    height: calc(100vh - 92px);
  }
  .jh-directory-card-body{
    height: calc(100vh - 167px);
  }
  .jh-dashboard-wrapper-card{
    height: calc(100vh - 92px);
    min-height: calc(100vh - 92px);
  }
  .jh-dashboard-card{
    box-shadow: 0 1px 20px 0 rgb(0 0 0 / 3%) !important;
  }
  .jh-statistics-card{
    flex: 1 !important;
    border-right: 1px solid #f5f5f5 !important;
    border-radius: 0 !important;
  }
  .jh-dashboard-card .jh-statistics-card:last-child{
    border-right: none !important;
  }
  .jh-dashboard-chip .v-slide-group__content{
    padding: 0 !important;
  }

  .v-chip-group .v-chip:last-child {
    margin-right: 0;
  }
</style>
{% endblock %}
